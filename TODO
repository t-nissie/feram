ToDo:
o dVdac.Fのために-finline-matmul-limit=7を使ってみる。
  https://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html

o cufft_*をgistかどこかに移動。

o dVdac.F の do j=1,6; do alpha=1,3 のループを
  展開して、if (j<=3) をなくせばさらに速くなるはず。

o Discard hysteresis_loop.F. Use n_E_wave_period and E_wave_type.
o src/hysteresis_loop.F DETAILED_MESSAGES

o src/23example-BaTiO3-new-param-hl-film-acoustic-mass/
  のバグを直す。0.22.04ではバグの再現さえしなくなり、パラの結果が出る。
  svn diff -r2271:2272 kinetic_energy_dipo.F でバグの再現はするようになったが、これはあくまでquick hack。
  dead layerがある場合など、c%n_sum_p と p%n_freedom = 3 * p%N とかの比を考慮すること。  
  src/mirror_force_mirror.Fで単にc%acouRとc%dVdacRをミラーすればよいわけではない。
  acoustic displacementは双極子でないので静電的ミラーではない！！！

o Use SSE or AVX with the latest assembler and FCFLAGS='-g -Wall -Ofast -msse4.2 -pipe -fopenmp'.

o TESTS for feram_slicer.rb and feram_cross-section-q.sh

o (nightly) automation of unit test with "make check"

o (nightly) automation of profiling and timing

o Replace jot(1) with seq(1). Do not use --separator option for seq. Use -s.

o Replace colrm(1) with cut(1).  `cut -b -14` is equivalent with `colrm 15`.

o No need to initialize Energy_type ???

o remove redundant procedures:
  - average_module.F: around u_tmp(:) =  u_tmp(:) + c%dipoR(ix,iy,iz,:)
  - molecular-dynamics.F: around u(alpha) = SUM(c%dipoR(:,:,:,alpha), MASK=c%sum_p(:,:,:))
  - Then, report uu() and energies in the .hl file.

o e%acou_kinetic=0 if mass_acou<0

o 'md' have to be changed to 'np' Nose-Poincare.
o Nose-Poincareでもacoustic displacementのMDができるように．
o Imprement Nose:JPhysSocJpn:70:p75-77:2001

o Use -simd=aggressive ???

o Do not make fft.F module. It receives complex as real.

o Error messages to stderr.

o Copyright

o Examples

o In initialize-dipoR.F, c%dipoP() must be multiplied by c%s_Nose after read ???

o FILENAME.avgの出力の見直し polarization -> <u_z> とか

o plot_dispersion = .ture. のとき32x32x32を使う。FILENAME.param.gp は無くす方向で。

o feram_slicer.rb マニュアル

o feram_cross_section マニュアル

o dVddi_... -> dV_du_...

o foo-bar.F -> foo_bar.F

o UNIT_SYSTEM の整理

o mirror_force_mirror.F の最後の力のミラーが必要かどうか。必然的に対称になっているはず。

o read_defects_u.F: we may have to count the number of free dipoles.

o  call dipoFFT(p,c)
   call  dVddi_dipole_dipole(p,c,e)
   call     dVddi_unharmonic(p,c,e)
   call        dVddi_E_field(p,c,e)
   call optimize_homo_strain(p,c,e)
   call optimize_inho_strain(p,c,e)
       は nose-poincare.F, leapfrog.F, initialize_dipoR.F に共通なのでまとめる。

o Makefile.amの依存関係。並列コンパイルmake -jでデバグできる。

o 依存関係の自動生成。gfortranに新しく導入される-Mオプションの活用？ makedepf90？

o Reduce memory size using in-place FFT and
  rank remapping or array dimension changing (See in-place-FFT.ja.txt)

o coord fileの桁数を上げて高精度化。ファイルサイズは大きくなってしまうけど。

o Use msg() in write_Param() of param_module.F.

o striped structure を initial configuration にできるようにする.

o refactoring nose-poincare.F and energy.F

o 3 node parallelization

o average 4倍精度に？

o start.coord があれば読み込む。alloc_Coord(p,c) で？

o (coord を かきだし はじめる ところ おわる ところ AVERAGE の あいだだけ)

o p, q, qdot にして, いつmassで割るか考える.

o Q_nose must be a function of T, N and delta_t. AUTOMATIC determination.

o Automatical determination of kappa
  kappa for the Ewald summation must be a function of Lx, Ly and Lz

o strain energy の 計算をする部分を分離.

o compare 16x16x16, 32x32x32 

o dipoI(3,3,:,:,:) Upper Triangle だけにする？
  FFTの計算はUpper Triangle だけやってC.C.をコピーするようにした.
  配列は3x3のまま.
  どのくらいメモリを減らせる？

o mass_acoustic, mass_strain なんか関係がある

o 3-dimensional hedgehog plot (`with vec` is not available for splot of GNUPLOT)

o interface文

o initial spin configuration をつくる program をわける？

o mass の 9648.53377163899 を define.h へ

o children, parents, use

o input file parserを作る。どんなparser？
  input file と param.gp とを共通化？
  タイトルも引数で指定できるようにしないと面倒臭い。

o call msg() DEPTH or p%message_depth

o Use class of Fortran 2003: class Ferroelectrics has a Param, a Coord and a Energy


Done:
x plot_dispersion = .ture. で分散関係が出力されるようにする。

x LARGE_MASS_INV = 1.0d0 / 1000000000.0d0

x 入力ファイルの整備

x .F -> .F90 やらない

x 16(kappa=0.22), 32(kappa=0.08), 64(kappa=0.055) で精度を検証
  dipole-dipole-long.dat が ??e-31になってるから OK?

x dipole-dipole.gp


x coord.F: complex*16, allocatable :: dipoP(:,:,:,:,:)
  real*8 にする

x make dipole-dipole.F's children
	short-range.F
	long-range.F
  dipole-dipole only と, それに short-range をくわえたものをふたつともだせるようにする.

x normal.f
  正規分布する乱数発生サブルーチン。参考文献をちゃんと書く。

x param.F
  初期dipole momentの平均値と標準偏差をを与えることが出来るようにする。
  分散 variance
  偏差 deviation  init_u_dev(3)
  平均 average    init_u_avg(3)

x Lz_periodic -> Lz      change mirror.f

x fft.F、SR11000用 HZFT7M()の代わりにHDFZ7M()とHZFD7M()とを使うようにして、
  さらに２度目の呼び出しから係数の計算などを省くようにする。要configure.acの変更。

x detailed_messages -> verbose, in configure.ac, README.en and source code

x Quit to use libblaslapack/

x p%mass_dipo の default value を 100 amu に

x p%acoustic_mass_amu の導入

x 交流電場を掛けられるようにして、hysteresis_loop.F と
  molecular-dynamics.F とを統合。sin, cos, (sawsin, sawcos,) ...

x Use wisdom

x Introduce  method = 'vs'  with src/velocity_scaling.F for MD.

x fft.FのDFZ7M()とHZFD7M()、Nx must be even???　→もうMATRIX/MPPは使わない

x -parallel for ifort -> Everythings are parallelized with OpenMP.

x add seeds to normal_dist(mu,sigma,seed1,seed2). speed up DOUBLE.

x acoustic displacement も MD.

x Temperature from averaging acou_kinetic and dipo_kinetic

x continue_without_restart_file for avoiding huge .coord files

x replace DSYEV().

x たとえMakefile.amに依存関係が適切に書かれていても、
  XL Fortranが書き出すa.lstが並列コンパイルの邪魔をする。
  a.lstは何？これはmakeの新オプション--output-sync（-O）で回避できる？

x slicer.rb -> feram_slicer.rb, eigenvalues2j -> feram_eigenvalues2j, etc.

x Remove "#if defined(HAVE_LIBFFTW3)" so that we always use FFTW


Not ToDo:
- 使うGPUって環境変数で選べるの？

