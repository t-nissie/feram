=begin
= How to compile feram
This document describes how to compile feram for your computers.
Version and date of installation is written in parentheses ().

== Requirements
 * GNU make  http://www.gnu.org/software/make/
 * FFTW3 library  http://www.fftw.org/ (For Intel and AMD machines.
   version 3.3 or higher. Configure FFTW3 library with options of
   --enable-openmp --enable-threads --enable-sse2.
   --enable-avx and --enable-shared are also useful additional configure options.
   Intel MKL contains FFTW3 wrappers.)
 * BLAS and LAPACK libraries (You do NOT have to used optimized BLAS,
   because LAPACK subroutines are not used in crucial parts of feram.)
 * Fortran 90 compiler
   * gfortran coming with GCC-4.2.2 or higher  http://gcc.gnu.org/
   * Intel Fortran Compiler (ifort; version 11.1 and later) with
     Intel Math Kernel Library (MKL; version 10.2 and later)
     http://software.intel.com/en-us/articles/intel-compilers/
   * IBM XL Fortran for HITACHI SR16000
   * Fortran 90 (frtpx) for Fujitsu supercomputers: Kei and FX10
 * tar (version 1.22 or higher)  http://www.gnu.org/software/tar/
 * xz  http://tukaani.org/xz/
Modern Linux distributions (Debian, Ubuntu, RedHat, CentOS, etc.) have their
packages of these software required to compile feram. Check their versions
with --version option, e.g. make --version, or install them with package
managers (apt-get, yum, etc.).

== Useful software
These software are useful for executing feram and analyzing calculated results.
 * gnuplot (version 4.6 or higher)
 * Ruby (version 1.8.6 or higher)
 * jot (Every Linux distributions are presenting jot packages. Or, find its source athena-jot_9.0.orig.tar.gz in the Net.)

== Requirements for developing feram
 * autoconf (version 2.64 or higher)
 * automake (version 1.11.1 higher)

== Quick compilation
If you have all the required libraries,
follow this quick compilation instruction.
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir Linux-i686-gfortran-4.3.5
 $ cd Linux-i686-gfortran-4.3.5
 $ ../configure --help
 $ ../configure
 $ cd src
 $ make
 $ make feram_mpi   # OPTIONAL. mpif90 is required.
 $ OMP_NUM_THREADS=6 make check   # OPTIONAL. Test RNG and FFT with marsaglia_tsang_uni64_check,
 $ evince marsaglia_tsang_uni64_check.eps   # marsaglia_tsang_uni64_timing and fft_check.
 $ ls -l feram*
 $ cp -r ../../src/11example-BaTiO3-new-hysteresis-loop .
 $ cd 11example-BaTiO3-new-hysteresis-loop
 $ ../feram hysteresis_d0.feram &         # test run
 $ ../feram hysteresis_d1_backwrd.feram & # 1day/1file
 $ ../feram hysteresis_d1_forward.feram &
 $ ../feram hysteresis_d2.feram &
 $ gnuplot all.gp  # plot a hysteresis loop
 $ gv all.eps      # preview

If you installed FFTW3 into your home directory,
specify CPPFLAGS and LDFLAGS for configure.
 $ ../configure FC=gfortran CPPFLAGS=-I/home/takeshi/include LDFLAGS=-L/home/takeshi/lib

FFTW3, BLAS and LAPACK libraries can be easily installed into
Debian 7.0 (wheezy) GNU/Linux system with
 # apt-get install libfftw3-dev libblas-dev liblapack-dev
Debian 7.0 will be released next spring (2013).

== Linux
=== Ubuntu 12.10 (feram-0.19.08, 2012-12-09)
==== install required packages
 $ sudo apt-get install liblapack-dev libblas-dev gfortran libfftw3-dev libfftw3-doc gfortran-doc
 $ sudo apt-get install autoconf automake libtool autoconf-doc libtool-doc   # For developers

==== compile feram
 $ tar xf feram-0.19.08.tar.xz
 $ mkdir feram-0.19.08/ubuntu-12.10
 $ cd feram-0.19.08/ubuntu-12.10
 $ ../configure && make
 $ make check

=== CentOS 6.2 (feram-0.18.05, 2012-03-28)
CentOS 6.2 can be installed to your x86_64 system with DVD and
CD-ROM images in http://isoredirect.centos.org/centos/6/isos/x86_64/ .

Network installation is also available with a CD-ROM image of
CentOS-6.2-x86_64-netinstall.iso. See
http://www.if-not-true-then-false.com/2011/centos-6-netinstall-network-installation/
for more details.

Select "Software Development Workstation" in the setup.

==== check the version of gfortran
 $ gfortran --version
 GNU Fortran (GCC) 4.4.6 ...

==== install fftw-3.3.1.tar.gz
 $ tar zxf fftw-3.3.1.tar.gz
 $ cd fftw-3.3.1
 $ mkdir CentOS
 $ cd CentOS
 $ ../configure --prefix=/usr/local --libdir=/usr/local/lib64 --enable-openmp --enable-threads --enable-sse2 --enable-avx --enable-shared
 $ emacs tools/Makefile   # Edit LIBFFTWTHREADS to link libfftw3_omp, not libfftw3_threads.
 $ make
 $ make check
 $ su
 # make install
 # exit

==== install BLAS and LAPACK
 $ su
 # yum install blas.x86_64 lapack.x86_64
 # cd /usr/lib64
 # ln -s libblas.so.3 libblas.so
 # ln -s liblapack.so.3 liblapack.so
 # exit
Symbolic links are for avoiding error of "/usr/bin/ld: cannot find -lblas".
See http://linuxtoolkit.blogspot.jp/2011/11/cannot-find-llapack-when-doing-usrbinld.html for more details.

==== compile feram
 $ export LD_LIBRARY_PATH=/usr/local/lib64   # Do not forget it.
 $ tar xf feram-0.18.05.tar.xz
 $ cd feram-0.18.05
 $ mkdir CentOS
 $ cd CentOS
 $ ../configure --help
 $ ../configure
 $ cd src
 $ make
 $ OMP_NUM_THREADS=6  make check
 $ OMP_NUM_THREADS=12 make check
 $ ls -l feram
 $ ldd feram

=== Linux with Intel Fortran Compiler and FFTW wrappers in Intel MKL
 $ . /opt/intel/bin/ifortvars.sh intel64     # Put these two lines in your
 $ . /opt/intel/mkl/bin/mklvars.sh intel64   # ~/.bashrc or somewhere.
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir ifort-11.1
 $ cd ifort-11.1
 $ ../configure --help
 $ ../configure FC=ifort CPPFLAGS="-I$MKLROOT/include/fftw" --with-fft=mkl --with-lapack=mkl
 $ cd src
 $ make
 $ make feram_mpi                 # OPTIONAL. mpif90 is required.
 $ OMP_NUM_THREADS=6 make check   # OPTIONAL. Test RNG and FFT.

=== Linux with Intel Fortran Compiler and FFTW library
Sometimes it is fater than MKL.
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir ifort-12.1-FFTW
 $ cd ifort-12.1-FFTW
 $ ../configure --help
 $ ../configure FC=ifort CPPFLAGS=-I/uhome/s21584/Linux-x86_64/include LDFLAGS=-L/uhome/s21584/Linux-x86_64/lib --with-fft=fftw3_omp --with-lapack=mkl
 $ cd src
 $ make
 $ make feram_mpi                 # OPTIONAL. mpif90 is required.
 $ OMP_NUM_THREADS=6 make check   # OPTIONAL. Test RNG and FFT.


== Super computers
=== HITACHI SR16000 with IBM xlf90_r, FFTW 3.3 and dsyevx in ESSL (libesslsmp)
Note that ESSL does not have dsyev() and zheev().
You may be able to use dsyevx() instead of dsyev().
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir SR16000-xlf
 $ cd SR16000-xlf
 $ ../configure FC=xlf90_r CPPFLAGS=-I/sysap/fftw_xlc/fftw-3.3.2a/include LDFLAGS=-L/sysap/fftw_xlc/fftw-3.3.2a/lib --with-lapack=essl
 $ cd src
 $ grep -v cppoptions /etc/xlf.cfg.71 > myxlf.cfg   # Enable C-style comments
 $ emacs Makefile   # DEFS = -DHAVE_CONFIG_H  =>  DEFS = -WF,-DHAVE_CONFIG_H -Fmyxlf.cfg
 $ make
 $ MALLOCMULTIHEAP=true LDR_CNTRL=LARGE_PAGE_DATA=M XLSMPOPTS="spins=0:yields=0:parthds=16:stride=1:startproc=0" make check

=== Fujitsu FX1
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir FX1
 $ cd FX1
 $ ../configure FC=frt --with-fft=ssl2 --with-lapack=ssl2
 $ cd src
 $ make
 $ make feram_mpi   # OPTIONAL

=== Fujitsu Kei and FX10 with their cross compiler frtpx and mpifrtpx
 $ tar xf feram-X.YY.ZZ.tar.xz
 $ cd feram-X.YY.ZZ
 $ mkdir Kei
 $ cd Kei
 $ ../configure FC=frtpx --with-fft=ssl2 --with-lapack=ssl2 --host=Kei   # use --host=FX10 for FX10
 $ cd src
 $ make
 $ make feram_mpi   # OPTIONAL

If you want to link FFTW 3.3 rather than FFT in SSL II,
 $ ../configure FC=frtpx LDFLAGS=-L/home2/apps/fftw/3.3/lib64 CPPFLAGS=-I/home2/apps/fftw/3.3/include --with-fft=fftw3 --with-lapack=ssl2 --host=Kei
 $ ../configure FC=frtpx LDFLAGS=-L/usr/local/fftw/3.3/lib64  CPPFLAGS=-I/usr/local/fftw/3.3/include  --with-fft=fftw3 --with-lapack=ssl2 --host=FX10


== Windows
=== MinGW


== Mac OS X

=end
# Local variables:
#   mode: RD
#   compile-command: "make INSTALL.html"
# End:
